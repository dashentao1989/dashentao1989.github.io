<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="android,annotation," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="定义（来自wiki）:In the Java computer programming language, an annotation is a form of syntactic metadata that can be added to Java source code. Classes, methods, variables, parameters and packages may be a">
<meta property="og:type" content="article">
<meta property="og:title" content="10分钟理解annotation原理">
<meta property="og:url" content="http://yoursite.com/2016/07/14/10分钟理解annotation原理/index.html">
<meta property="og:site_name" content="CoffeeTao的技术生活">
<meta property="og:description" content="定义（来自wiki）:In the Java computer programming language, an annotation is a form of syntactic metadata that can be added to Java source code. Classes, methods, variables, parameters and packages may be a">
<meta property="og:image" content="http://bxbxbai.github.io/img/java_compiler.png">
<meta property="og:updated_time" content="2016-07-19T09:31:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="10分钟理解annotation原理">
<meta name="twitter:description" content="定义（来自wiki）:In the Java computer programming language, an annotation is a form of syntactic metadata that can be added to Java source code. Classes, methods, variables, parameters and packages may be a">
<meta name="twitter:image" content="http://bxbxbai.github.io/img/java_compiler.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2016/07/14/10分钟理解annotation原理/"/>

  <title> 10分钟理解annotation原理 | CoffeeTao的技术生活 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">CoffeeTao的技术生活</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">生活在于折腾...</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                10分钟理解annotation原理
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-14T14:04:46+08:00" content="2016-07-14">
              2016-07-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/14/10分钟理解annotation原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/14/10分钟理解annotation原理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="定义（来自wiki）"><a href="#定义（来自wiki）" class="headerlink" title="定义（来自wiki）:"></a>定义（来自wiki）:</h3><p><em>In the Java computer programming language, an annotation is a form of syntactic metadata that can be added to Java source code. Classes, methods, variables, parameters and packages may be annotated. Unlike Javadoc tags, Java annotations can be reflective in that they can be embedded in class files generated by the compiler and may be retained by the Java VM to be made retrievable at run-time. It is possible to create meta-annotations out of the existing ones in Java.</em></p>
<p>在java计算机编程语言中，注解是一种能够被添加到源代码中的元数据语法。类，方法，变量，参数和包都能够被注解修饰，与javadoc标签不同，java注释表现为嵌入在编译器生成的类文件中，可以由java虚拟机保留供运行时检索，你能够定制非java原生的元数据注解。</p>
<h3 id="Annotation-分类"><a href="#Annotation-分类" class="headerlink" title="Annotation 分类"></a>Annotation 分类</h3><ul>
<li><p>Built-in annotations(Java defines a set of annotations that are built into the language)</p>
<ul>
<li>Mark annotations(Annotations applied to Java code)</li>
<li>Meta annotations(Annotations applied to other annotations )</li>
</ul>
</li>
<li><p>Custom annotations</p>
</li>
</ul>
<h3 id="Annotation分类详解"><a href="#Annotation分类详解" class="headerlink" title="Annotation分类详解"></a>Annotation分类详解</h3><p><strong>主要分为两大类：</strong></p>
<h4 id="Built-in-annotations"><a href="#Built-in-annotations" class="headerlink" title="Built-in annotations"></a>Built-in annotations</h4><p><em>java定义了一组编译到语言中的注解集合</em></p>
<h6 id="Mark-annotations"><a href="#Mark-annotations" class="headerlink" title="Mark annotations"></a>Mark annotations</h6><p><em>对java源代码的注解集合，例如：<br>@Override, @Deprecated, @SuppressWarnings等</em></p>
<ul>
<li>@Override 重写函数</li>
<li>@Deprecated 方法已过期，不建议使用</li>
<li>@SuppressWarning 忽略warning</li>
</ul>
<h6 id="Meta-annotations"><a href="#Meta-annotations" class="headerlink" title="Meta annotations"></a>Meta annotations</h6><p><em>修饰其他注解（例如：自定义注解）的注解集合。例如：@Retention, @Target, @Inherited, @Documented</em></p>
<ul>
<li>@Documented 用于描述其他类型的annotation应该被作为被标注的程序成员的公共API，可以被javdoc的工具文档化，无成员。</li>
<li>@Retention 保留时间， 可选值 SOURCE（源码时），CLASS（编译时），RUNTIME（运行时），默认为 CLASS，SOURCE 大都为 Mark Annotation，这类 Annotation 大都用来校验，比如 Override, SuppressWarnings。</li>
<li><p>@Target 描述注解的使用范围，未标注则表示可修饰所有,常用的修饰符如下:</p>
<ol>
<li>ElementType.CONSTRUCTOR:描述构造器</li>
<li>ElementType.FIELD:描述成员变量</li>
<li>ElementType.VARIABLE: 描述局部变量</li>
<li>ElementType.METHOD: 描述方法</li>
<li>ElementType.PACKAGE: 描述包</li>
<li>ElementType.PARAMETER：描述方法的参数</li>
<li>ElementType.Type: 描述类，接口（包括注解类型）或enum声明</li>
</ol>
</li>
<li><p>@inherited 用于标注某个标注是被继承的，即父类中使用了一个Annotation，则子类继承父类的这个annotation，annotation需要标记为RUNTIME的才可以, 默认为false。</p>
</li>
</ul>
<h4 id="Custom-annotations"><a href="#Custom-annotations" class="headerlink" title="Custom annotations"></a>Custom annotations</h4><p><em>根据自己需求自定义的注解，定义时需要用到上面的元 Annotation<br>这里是一种分类而已，也可以根据作用域分为源码时、编译时、运行时 Annotation，后面在自定义 Annotation 时会具体介绍</em></p>
<p><strong>自定义annotations主要分为编译时与运行时</strong></p>
<h5 id="CLASS-编译时"><a href="#CLASS-编译时" class="headerlink" title="CLASS(编译时)"></a>CLASS(编译时)</h5><p>以下内容摘抄自<a href="http://hannesdorfmann.com/annotation-processing/annotationprocessing101" target="_blank" rel="external">annotation-processing</a>,感兴趣请阅读原文。</p>
<h5 id="Annotation-Processor"><a href="#Annotation-Processor" class="headerlink" title="Annotation Processor"></a>Annotation Processor</h5><p>是javac的一个工具，它用来在编译时扫描和处理注解（Annotation）。你可以对自定义注解，并注册相应的注解处理器。到这里，我假设你已经知道什么是注解，并且知道怎么申明的一个注解。如果你不熟悉注解，你可以在这官方文档中得到更多信息。注解处理器在Java 5开始就有了，但是从Java 6（2006年12月发布）开始才有可用的API。过了一些时间，Java世界才意识到注解处理器的强大作用，所以它到最近几年才流行起来。</p>
<p>一个注解的注解处理器，以Java代码（或者编译过的字节码）作为输入，生成文件（通常是.java文件）作为输出。这具体的含义什么呢？你可以生成Java代码！这些生成的Java代码是在生成的.java文件中，所以你不能修改已经存在的Java类，例如向已有的类中添加方法。这些生成的Java文件，会同其他普通的手动编写的Java源代码一样被javac编译。</p>
<p>编译代码的过程：<br><img src="http://bxbxbai.github.io/img/java_compiler.png" alt=""></p>
<h6 id="虚处理器AbstractProcessor"><a href="#虚处理器AbstractProcessor" class="headerlink" title="虚处理器AbstractProcessor"></a>虚处理器AbstractProcessor</h6><p>我们首先看一下处理器的API。每一个处理器都是继承于AbstractProcessor，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment env)</span></span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annoations, RoundEnvironment env)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getSupportedAnnotationTypes</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SourceVersion <span class="title">getSupportedSourceVersion</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>init(ProcessingEnvironment env): 每一个注解处理器类都必须有一个空的构造函数。然而，这里有一个特殊的init()方法，它会被注解处理工具调用，并输入ProcessingEnviroment参数。ProcessingEnviroment提供很多有用的工具类Elements, Types和Filer。</p>
</li>
<li><p>process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env): 这相当于每个处理器的主函数main()。你在这里写你的扫描、评估和处理注解的代码，以及生成Java文件。输入参数RoundEnviroment，可以让你查询出包含特定注解的被注解元素。</p>
</li>
<li><p>getSupportedAnnotationTypes(): 这里你必须指定，这个注解处理器是注册给哪个注解的。注意，它的返回值是一个字符串的集合，包含本处理器想要处理的注解类型的合法全称。换句话说，你在这里定义你的注解处理器注册到哪些注解上。</p>
</li>
<li><p>getSupportedSourceVersion(): 用来注定你使用的java版本，通常这里返回SourceVersion.latestSupported()。然而，如果你有足够的理由只支持java6的话，你也可以返回SourceVersion.RELEASE_6。我推荐你使用前者。</p>
</li>
</ul>
<p>在Java 7中，你也可以使用注解来代替getSupportedAnnotationTypes()和getSupportedSourceVersion()，像这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedSourceVersion</span>(SourceVersion.latestSupported())</span><br><span class="line"><span class="meta">@SupportedAnnotationTypes</span>(&#123;</span><br><span class="line">   <span class="comment">// 合法注解全名的集合</span></span><br><span class="line"> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment env)</span></span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annoations, RoundEnvironment env)</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>因为兼容的原因，特别是针对Android平台，我建议使用重载getSupportedAnnotationTypes()和getSupportedSourceVersion()方法代替@SupportedAnnotationTypes和@SupportedSourceVersion。</p>
<p>接下来的你必须知道的事情是，注解处理器是运行它自己的虚拟机JVM中。是的，你没有看错，javac启动一个完整Java虚拟机来运行注解处理器。这对你意味着什么？你可以使用任何你在其他java应用中使用的的东西。使用guava。如果你愿意，你可以使用依赖注入工具，例如dagger或者其他你想要的类库。但是不要忘记，即使是一个很小的处理，你也要像其他Java应用一样，注意算法效率，以及设计模式。</p>
<h5 id="RUNTIME-运行时"><a href="#RUNTIME-运行时" class="headerlink" title="RUNTIME(运行时)"></a>RUNTIME(运行时)</h5><p><em>创建注解类：</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> YouzanCard &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Youzan &#123;</span><br><span class="line">    @YouzanCard(name = &quot;people1&quot;, id = 1)</span><br><span class="line">    private void people1() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @YouzanCard(name = &quot;people2&quot;, id = 2)</span><br><span class="line">    private void people2() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @YouzanCard(name = &quot;people3&quot;, id = 3)</span><br><span class="line">    private void people3() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>调用:</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Youzan youzan = <span class="keyword">new</span> Youzan();</span><br><span class="line">        ParseUtil.parse(youzan);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (object != <span class="keyword">null</span> &amp;&amp; !isSystemCalss(object.getClass().getName())) &#123;</span><br><span class="line">            Method[] methods = object.getClass().getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; methods.length; i++) &#123;</span><br><span class="line">                Method method = methods[i];</span><br><span class="line">                System.out.println(method.getName());</span><br><span class="line">                <span class="keyword">if</span> (methods[i].isAnnotationPresent(YouzanCard.class)) &#123;</span><br><span class="line">                    String name = method.getAnnotation(YouzanCard.class).name();</span><br><span class="line">                    <span class="keyword">int</span> id = method.getAnnotation(YouzanCard.class).id();</span><br><span class="line">                    System.out.println(<span class="string">"name = "</span> + name + <span class="string">", id = "</span> + id</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>打印日志:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">people1</span><br><span class="line">name = people1, id = <span class="number">1</span></span><br><span class="line">people2</span><br><span class="line">name = people2, id = <span class="number">2</span></span><br><span class="line">people3</span><br><span class="line">name = people3, id = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>常用的API:</p>
<ul>
<li><p>boolean isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)<em>判断调用方是否被annotationClass注解修饰。</em></p>
</li>
<li><p>Annotation[] getAnnotations()<em>得到调用方的注解集合。</em></p>
</li>
<li><p><t extends="" annotation=""> T getAnnotation(Class<t> annotationClass)<em>得到调用方的被修饰的注解信息，应为一个调用方可以被多个注解修饰。</em></t></t></p>
</li>
</ul>
<h5 id="知名项目自定义注解集锦："><a href="#知名项目自定义注解集锦：" class="headerlink" title="知名项目自定义注解集锦："></a>知名项目自定义注解集锦：</h5><h6 id="ButterKnife-编译时"><a href="#ButterKnife-编译时" class="headerlink" title="ButterKnife(编译时)"></a>ButterKnife(编译时)</h6><ul>
<li>注解类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(CLASS) <span class="meta">@Target</span>(FIELD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BindView &#123;</span><br><span class="line">  <span class="comment">/** View ID to which the field will be bound. */</span></span><br><span class="line">  <span class="meta">@IdRes</span> <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注解解析器(ButterKnifeProcessor)</li>
</ul>
<p>init</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment env)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.init(env);</span><br><span class="line"></span><br><span class="line">    elementUtils = env.getElementUtils();</span><br><span class="line">    typeUtils = env.getTypeUtils();</span><br><span class="line">    filer = env.getFiler();</span><br><span class="line">    trees = Trees.instance(processingEnv);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>getSupportedAnnotationTypes</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getSupportedAnnotationTypes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Set&lt;String&gt; types = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Class&lt;? extends Annotation&gt; annotation : getSupportedAnnotations()) &#123;</span><br><span class="line">      types.add(annotation.getCanonicalName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> types;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Set&lt;Class&lt;? extends Annotation&gt;&gt; getSupportedAnnotations() &#123;</span><br><span class="line">    Set&lt;Class&lt;? extends Annotation&gt;&gt; annotations = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    annotations.add(BindArray.class);</span><br><span class="line">    annotations.add(BindBitmap.class);</span><br><span class="line">    annotations.add(BindBool.class);</span><br><span class="line">    annotations.add(BindColor.class);</span><br><span class="line">    annotations.add(BindDimen.class);</span><br><span class="line">    annotations.add(BindDrawable.class);</span><br><span class="line">    annotations.add(BindInt.class);</span><br><span class="line">    annotations.add(BindString.class);</span><br><span class="line">    annotations.add(BindView.class);</span><br><span class="line">    annotations.add(BindViews.class);</span><br><span class="line">    annotations.addAll(LISTENERS);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> annotations;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>getSupportedSourceVersion</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> SourceVersion <span class="title">getSupportedSourceVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> SourceVersion.latestSupported();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>process</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; elements, RoundEnvironment env)</span> </span>&#123;</span><br><span class="line">   Map&lt;TypeElement, BindingClass&gt; targetClassMap = findAndParseTargets(env);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (Map.Entry&lt;TypeElement, BindingClass&gt; entry : targetClassMap.entrySet()) &#123;</span><br><span class="line">     TypeElement typeElement = entry.getKey();</span><br><span class="line">     BindingClass bindingClass = entry.getValue();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span> (JavaFile javaFile : bindingClass.brewJava()) &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">         javaFile.writeTo(filer);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         error(typeElement, <span class="string">"Unable to write view binder for type %s: %s"</span>, typeElement,</span><br><span class="line">             e.getMessage());</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>当它发现一个类中含有任何一个注解时，ButterKnifeProcessor会通过<a href="https://github.com/square/javapoet" target="_blank" rel="external">javapoet</a>生成.java文件，名字类似<classname>$$ViewBinder，这个新生成的类实现了ViewBinder<t>接口</t></classname></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Collection&lt;JavaFile&gt; <span class="title">brewJava</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TypeSpec.Builder result = TypeSpec.classBuilder(binderClassName)</span><br><span class="line">            .addModifiers(PUBLIC, FINAL)</span><br><span class="line">            .addSuperinterface(ParameterizedTypeName.get(VIEW_BINDER, targetTypeName));</span><br><span class="line"></span><br><span class="line">    result.addMethod(createBindMethod(targetTypeName));</span><br><span class="line"></span><br><span class="line">    List&lt;JavaFile&gt; files = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (isGeneratingUnbinder()) &#123;</span><br><span class="line">      files.add(JavaFile.builder(unbinderClassName.packageName(), createUnbinderClass())</span><br><span class="line">              .addFileComment(<span class="string">"Generated code from Butter Knife. Do not modify!"</span>)</span><br><span class="line">              .build()</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isFinal) &#123;</span><br><span class="line">      result.addMethod(createBindToTargetMethod());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    files.add(JavaFile.builder(binderClassName.packageName(), result.build())</span><br><span class="line">            .addFileComment(<span class="string">"Generated code from Butter Knife. Do not modify!"</span>)</span><br><span class="line">            .build());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> files;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h6 id="AndroidEventBus-运行时"><a href="#AndroidEventBus-运行时" class="headerlink" title="AndroidEventBus(运行时)"></a>AndroidEventBus(运行时)</h6><ul>
<li>注解类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Subscriber &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 事件的tag,类似于BroadcastReceiver中的Action,事件的标识符</span><br><span class="line">     * </span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">String <span class="title">tag</span><span class="params">()</span> <span class="keyword">default</span> EventType.DEFAULT_TAG</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 事件执行的线程,默认为主线程</span><br><span class="line">     * </span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">ThreadMode <span class="title">mode</span><span class="params">()</span> <span class="keyword">default</span> ThreadMode.MAIN</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>解析注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findSubcribeMethods</span><span class="params">(Object subscriber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mSubcriberMap == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"the mSubcriberMap is null. "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt; clazz = subscriber.getClass();</span><br><span class="line">        <span class="comment">// 查找类中符合要求的注册方法,直到Object类</span></span><br><span class="line">        <span class="keyword">while</span> (clazz != <span class="keyword">null</span> &amp;&amp; !isSystemCalss(clazz.getName())) &#123;</span><br><span class="line">            <span class="keyword">final</span> Method[] allMethods = clazz.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; allMethods.length; i++) &#123;</span><br><span class="line">                Method method = allMethods[i];</span><br><span class="line">                <span class="comment">// 根据注解来解析函数</span></span><br><span class="line">                Subscriber annotation = method.getAnnotation(Subscriber.class);</span><br><span class="line">                <span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 获取方法参数</span></span><br><span class="line">                    Class&lt;?&gt;[] paramsTypeClass = method.getParameterTypes();</span><br><span class="line">                    <span class="comment">// 订阅函数只支持一个参数</span></span><br><span class="line">                    <span class="keyword">if</span> (paramsTypeClass != <span class="keyword">null</span> &amp;&amp; paramsTypeClass.length == <span class="number">1</span>) &#123;</span><br><span class="line">                        Class&lt;?&gt; paramType = convertType(paramsTypeClass[<span class="number">0</span>]);</span><br><span class="line">                        EventType eventType = <span class="keyword">new</span> EventType(paramType, annotation.tag());</span><br><span class="line">                        TargetMethod subscribeMethod = <span class="keyword">new</span> TargetMethod(method, eventType,</span><br><span class="line">                                annotation.mode());</span><br><span class="line">                        subscibe(eventType, subscribeMethod, subscriber);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="comment">// end for</span></span><br><span class="line">              <span class="comment">// 获取父类,以继续查找父类中符合要求的方法</span></span><br><span class="line">            clazz = clazz.getSuperclass();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>反射调用上层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleEvent</span><span class="params">(Subscription subscription, Object event)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (subscription == <span class="keyword">null</span></span><br><span class="line">               || subscription.subscriber.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// 执行</span></span><br><span class="line">           subscription.targetMethod.invoke(subscription.subscriber.get(), event);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/android/" rel="tag">#android</a>
          
            <a href="/tags/annotation/" rel="tag">#annotation</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/07/08/Android-Support-Annotations简介/" rel="next" title="Android Support Annotations简介">
                <i class="fa fa-chevron-left"></i> Android Support Annotations简介
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/07/21/gradle-caches/" rel="prev" title="gradle caches">
                gradle caches <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/07/14/10分钟理解annotation原理/"
           data-title="10分钟理解annotation原理" data-url="http://yoursite.com/2016/07/14/10分钟理解annotation原理/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://upload.cccnews.com.cn/2014/0313/1394690263626.jpg"
               alt="CoffeeTao" />
          <p class="site-author-name" itemprop="name">CoffeeTao</p>
          <p class="site-description motion-element" itemprop="description">生活在于折腾！</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">36</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://github.com/dashentao1989" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2433556600/profile?topnav=1&wvr=6&is_all=1" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#定义（来自wiki）"><span class="nav-number">1.</span> <span class="nav-text">定义（来自wiki）:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Annotation-分类"><span class="nav-number">2.</span> <span class="nav-text">Annotation 分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Annotation分类详解"><span class="nav-number">3.</span> <span class="nav-text">Annotation分类详解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Built-in-annotations"><span class="nav-number">3.1.</span> <span class="nav-text">Built-in annotations</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Mark-annotations"><span class="nav-number">3.1.0.1.</span> <span class="nav-text">Mark annotations</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Meta-annotations"><span class="nav-number">3.1.0.2.</span> <span class="nav-text">Meta annotations</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Custom-annotations"><span class="nav-number">3.2.</span> <span class="nav-text">Custom annotations</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#CLASS-编译时"><span class="nav-number">3.2.1.</span> <span class="nav-text">CLASS(编译时)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Annotation-Processor"><span class="nav-number">3.2.2.</span> <span class="nav-text">Annotation Processor</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#虚处理器AbstractProcessor"><span class="nav-number">3.2.2.1.</span> <span class="nav-text">虚处理器AbstractProcessor</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RUNTIME-运行时"><span class="nav-number">3.2.3.</span> <span class="nav-text">RUNTIME(运行时)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#知名项目自定义注解集锦："><span class="nav-number">3.2.4.</span> <span class="nav-text">知名项目自定义注解集锦：</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#ButterKnife-编译时"><span class="nav-number">3.2.4.1.</span> <span class="nav-text">ButterKnife(编译时)</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#AndroidEventBus-运行时"><span class="nav-number">3.2.4.2.</span> <span class="nav-text">AndroidEventBus(运行时)</span></a></li></ol></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CoffeeTao</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"dashentao1989"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  

  

  

</body>
</html>
