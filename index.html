<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="生活在于折腾！">
<meta property="og:type" content="website">
<meta property="og:title" content="CoffeeTao的技术生活">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="CoffeeTao的技术生活">
<meta property="og:description" content="生活在于折腾！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CoffeeTao的技术生活">
<meta name="twitter:description" content="生活在于折腾！">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> CoffeeTao的技术生活 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">CoffeeTao的技术生活</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">生活在于折腾...</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/21/gradle-caches/" itemprop="url">
                  gradle caches
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-21T10:40:57+08:00" content="2016-07-21">
              2016-07-21
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/21/gradle-caches/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/21/gradle-caches/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://stackoverflow.com/questions/10834111/gradle-store-on-local-file-system" target="_blank" rel="external">原文链接</a></p>
<p>gradle compile的module本地缓存在USER_HOME/.gradle文件下面，已经编译过的依赖组件通常在.gradle文件下该module的文件中。</p>
<p>假如你没有找到cache缓存资源,可能是你还没有下载相应的依赖，你能通过以下的方式进行编译依赖和验证，打印cache的缓存位置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="function">compile <span class="title">fileTree</span><span class="params">(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span></span><br><span class="line">    testCompile 'junit:junit:4.12'</span><br><span class="line">    compile 'com.android.support:appcompat-v7:23.4.0'</span><br><span class="line">    compile 'com.jakewharton:butterknife:8.2.1'</span><br><span class="line">    apt 'com.jakewharton:butterknife-compiler:8.2.1'</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task showMeCache &lt;&lt; </span>&#123;</span><br><span class="line">    configurations.compile.each &#123; println it &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Terminal输入./gradlew showMeCache结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hongentaodeMacBook-Pro:EmojiTest hongentao$ ./gradlew showMeCache</span><br><span class="line">Incremental java compilation is an incubating feature.</span><br><span class="line">:app:showMeCache</span><br><span class="line">/Users/hongentao/Library/Android/sdk/extras/android/m2repository/com/android/support/appcompat-v7/23.4.0/appcompat-v7-23.4.0.aar</span><br><span class="line">/Users/hongentao/.gradle/caches/modules-2/files-2.1/com.jakewharton/butterknife/8.2.1/e34d6aa04cea3390ed16364599ff6f4f84549c4d/butterknife-8.2.1.aar</span><br><span class="line">/Users/hongentao/Library/Android/sdk/extras/android/m2repository/com/android/support/animated-vector-drawable/23.4.0/animated-vector-drawable-23.4.0.aar</span><br><span class="line">/Users/hongentao/Library/Android/sdk/extras/android/m2repository/com/android/support/support-v4/23.4.0/support-v4-23.4.0.aar</span><br><span class="line">/Users/hongentao/Library/Android/sdk/extras/android/m2repository/com/android/support/support-vector-drawable/23.4.0/support-vector-drawable-23.4.0.aar</span><br><span class="line">/Users/hongentao/.gradle/caches/modules-2/files-2.1/com.jakewharton/butterknife-annotations/8.2.1/d6f54d76edfbe779a50a8636b10fd3f555d8f780/butterknife-annotations-8.2.1.jar</span><br><span class="line">/Users/hongentao/.gradle/caches/modules-2/files-2.1/com.android.support/support-annotations/24.0.0/2943c74db6d4346ab8c6531adac91fa05c137c40/support-annotations-24.0.0.jar</span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line"></span><br><span class="line">Total time: 6.939 secs</span><br></pre></td></tr></table></figure>
<p>看上面的打印日志明显可以看出cache的本地缓存位置为：USER_HOME/.gradle/caches/modules-2/file-2.1/…</p>
<p>打开Terminal验证下：<br><img src="http://chuantu.biz/t5/19/1469078365x3738746535.png" alt=""></p>
<p>好了,又学到了新姿势。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/14/10分钟理解annotation原理/" itemprop="url">
                  10分钟理解annotation原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-14T14:04:46+08:00" content="2016-07-14">
              2016-07-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/14/10分钟理解annotation原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/14/10分钟理解annotation原理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="定义（来自wiki）"><a href="#定义（来自wiki）" class="headerlink" title="定义（来自wiki）:"></a>定义（来自wiki）:</h3><p><em>In the Java computer programming language, an annotation is a form of syntactic metadata that can be added to Java source code. Classes, methods, variables, parameters and packages may be annotated. Unlike Javadoc tags, Java annotations can be reflective in that they can be embedded in class files generated by the compiler and may be retained by the Java VM to be made retrievable at run-time. It is possible to create meta-annotations out of the existing ones in Java.</em></p>
<p>在java计算机编程语言中，注解是一种能够被添加到源代码中的元数据语法。类，方法，变量，参数和包都能够被注解修饰，与javadoc标签不同，java注释表现为嵌入在编译器生成的类文件中，可以由java虚拟机保留供运行时检索，你能够定制非java原生的元数据注解。</p>
<h3 id="Annotation-分类"><a href="#Annotation-分类" class="headerlink" title="Annotation 分类"></a>Annotation 分类</h3><ul>
<li><p>Built-in annotations(Java defines a set of annotations that are built into the language)</p>
<ul>
<li>Mark annotations(Annotations applied to Java code)</li>
<li>Meta annotations(Annotations applied to other annotations )</li>
</ul>
</li>
<li><p>Custom annotations</p>
</li>
</ul>
<h3 id="Annotation分类详解"><a href="#Annotation分类详解" class="headerlink" title="Annotation分类详解"></a>Annotation分类详解</h3><p><strong>主要分为两大类：</strong></p>
<h4 id="Built-in-annotations"><a href="#Built-in-annotations" class="headerlink" title="Built-in annotations"></a>Built-in annotations</h4><p><em>java定义了一组编译到语言中的注解集合</em></p>
<h6 id="Mark-annotations"><a href="#Mark-annotations" class="headerlink" title="Mark annotations"></a>Mark annotations</h6><p><em>对java源代码的注解集合，例如：<br>@Override, @Deprecated, @SuppressWarnings等</em></p>
<ul>
<li>@Override 重写函数</li>
<li>@Deprecated 方法已过期，不建议使用</li>
<li>@SuppressWarning 忽略warning</li>
</ul>
<h6 id="Meta-annotations"><a href="#Meta-annotations" class="headerlink" title="Meta annotations"></a>Meta annotations</h6><p><em>修饰其他注解（例如：自定义注解）的注解集合。例如：@Retention, @Target, @Inherited, @Documented</em></p>
<ul>
<li>@Documented 用于描述其他类型的annotation应该被作为被标注的程序成员的公共API，可以被javdoc的工具文档化，无成员。</li>
<li>@Retention 保留时间， 可选值 SOURCE（源码时），CLASS（编译时），RUNTIME（运行时），默认为 CLASS，SOURCE 大都为 Mark Annotation，这类 Annotation 大都用来校验，比如 Override, SuppressWarnings。</li>
<li><p>@Target 描述注解的使用范围，未标注则表示可修饰所有,常用的修饰符如下:</p>
<ol>
<li>ElementType.CONSTRUCTOR:描述构造器</li>
<li>ElementType.FIELD:描述成员变量</li>
<li>ElementType.VARIABLE: 描述局部变量</li>
<li>ElementType.METHOD: 描述方法</li>
<li>ElementType.PACKAGE: 描述包</li>
<li>ElementType.PARAMETER：描述方法的参数</li>
<li>ElementType.Type: 描述类，接口（包括注解类型）或enum声明</li>
</ol>
</li>
<li><p>@inherited 用于标注某个标注是被继承的，即父类中使用了一个Annotation，则子类继承父类的这个annotation，annotation需要标记为RUNTIME的才可以, 默认为false。</p>
</li>
</ul>
<h4 id="Custom-annotations"><a href="#Custom-annotations" class="headerlink" title="Custom annotations"></a>Custom annotations</h4><p><em>根据自己需求自定义的注解，定义时需要用到上面的元 Annotation<br>这里是一种分类而已，也可以根据作用域分为源码时、编译时、运行时 Annotation，后面在自定义 Annotation 时会具体介绍</em></p>
<p><strong>自定义annotations主要分为编译时与运行时</strong></p>
<h5 id="CLASS-编译时"><a href="#CLASS-编译时" class="headerlink" title="CLASS(编译时)"></a>CLASS(编译时)</h5><p>以下内容摘抄自<a href="http://hannesdorfmann.com/annotation-processing/annotationprocessing101" target="_blank" rel="external">annotation-processing</a>,感兴趣请阅读原文。</p>
<h5 id="Annotation-Processor"><a href="#Annotation-Processor" class="headerlink" title="Annotation Processor"></a>Annotation Processor</h5><p>是javac的一个工具，它用来在编译时扫描和处理注解（Annotation）。你可以对自定义注解，并注册相应的注解处理器。到这里，我假设你已经知道什么是注解，并且知道怎么申明的一个注解。如果你不熟悉注解，你可以在这官方文档中得到更多信息。注解处理器在Java 5开始就有了，但是从Java 6（2006年12月发布）开始才有可用的API。过了一些时间，Java世界才意识到注解处理器的强大作用，所以它到最近几年才流行起来。</p>
<p>一个注解的注解处理器，以Java代码（或者编译过的字节码）作为输入，生成文件（通常是.java文件）作为输出。这具体的含义什么呢？你可以生成Java代码！这些生成的Java代码是在生成的.java文件中，所以你不能修改已经存在的Java类，例如向已有的类中添加方法。这些生成的Java文件，会同其他普通的手动编写的Java源代码一样被javac编译。</p>
<p>编译代码的过程：<br><img src="http://bxbxbai.github.io/img/java_compiler.png" alt=""></p>
<h6 id="虚处理器AbstractProcessor"><a href="#虚处理器AbstractProcessor" class="headerlink" title="虚处理器AbstractProcessor"></a>虚处理器AbstractProcessor</h6><p>我们首先看一下处理器的API。每一个处理器都是继承于AbstractProcessor，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment env)</span></span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annoations, RoundEnvironment env)</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getSupportedAnnotationTypes</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SourceVersion <span class="title">getSupportedSourceVersion</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>init(ProcessingEnvironment env): 每一个注解处理器类都必须有一个空的构造函数。然而，这里有一个特殊的init()方法，它会被注解处理工具调用，并输入ProcessingEnviroment参数。ProcessingEnviroment提供很多有用的工具类Elements, Types和Filer。</p>
</li>
<li><p>process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env): 这相当于每个处理器的主函数main()。你在这里写你的扫描、评估和处理注解的代码，以及生成Java文件。输入参数RoundEnviroment，可以让你查询出包含特定注解的被注解元素。</p>
</li>
<li><p>getSupportedAnnotationTypes(): 这里你必须指定，这个注解处理器是注册给哪个注解的。注意，它的返回值是一个字符串的集合，包含本处理器想要处理的注解类型的合法全称。换句话说，你在这里定义你的注解处理器注册到哪些注解上。</p>
</li>
<li><p>getSupportedSourceVersion(): 用来注定你使用的java版本，通常这里返回SourceVersion.latestSupported()。然而，如果你有足够的理由只支持java6的话，你也可以返回SourceVersion.RELEASE_6。我推荐你使用前者。</p>
</li>
</ul>
<p>在Java 7中，你也可以使用注解来代替getSupportedAnnotationTypes()和getSupportedSourceVersion()，像这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedSourceVersion</span>(SourceVersion.latestSupported())</span><br><span class="line"><span class="meta">@SupportedAnnotationTypes</span>(&#123;</span><br><span class="line">   <span class="comment">// 合法注解全名的集合</span></span><br><span class="line"> &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment env)</span></span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annoations, RoundEnvironment env)</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>因为兼容的原因，特别是针对Android平台，我建议使用重载getSupportedAnnotationTypes()和getSupportedSourceVersion()方法代替@SupportedAnnotationTypes和@SupportedSourceVersion。</p>
<p>接下来的你必须知道的事情是，注解处理器是运行它自己的虚拟机JVM中。是的，你没有看错，javac启动一个完整Java虚拟机来运行注解处理器。这对你意味着什么？你可以使用任何你在其他java应用中使用的的东西。使用guava。如果你愿意，你可以使用依赖注入工具，例如dagger或者其他你想要的类库。但是不要忘记，即使是一个很小的处理，你也要像其他Java应用一样，注意算法效率，以及设计模式。</p>
<h5 id="RUNTIME-运行时"><a href="#RUNTIME-运行时" class="headerlink" title="RUNTIME(运行时)"></a>RUNTIME(运行时)</h5><p><em>创建注解类：</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> YouzanCard &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class Youzan &#123;</span><br><span class="line">    @YouzanCard(name = &quot;people1&quot;, id = 1)</span><br><span class="line">    private void people1() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @YouzanCard(name = &quot;people2&quot;, id = 2)</span><br><span class="line">    private void people2() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @YouzanCard(name = &quot;people3&quot;, id = 3)</span><br><span class="line">    private void people3() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>调用:</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Youzan youzan = <span class="keyword">new</span> Youzan();</span><br><span class="line">        ParseUtil.parse(youzan);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parse</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (object != <span class="keyword">null</span> &amp;&amp; !isSystemCalss(object.getClass().getName())) &#123;</span><br><span class="line">            Method[] methods = object.getClass().getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; methods.length; i++) &#123;</span><br><span class="line">                Method method = methods[i];</span><br><span class="line">                System.out.println(method.getName());</span><br><span class="line">                <span class="keyword">if</span> (methods[i].isAnnotationPresent(YouzanCard.class)) &#123;</span><br><span class="line">                    String name = method.getAnnotation(YouzanCard.class).name();</span><br><span class="line">                    <span class="keyword">int</span> id = method.getAnnotation(YouzanCard.class).id();</span><br><span class="line">                    System.out.println(<span class="string">"name = "</span> + name + <span class="string">", id = "</span> + id</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>打印日志:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">people1</span><br><span class="line">name = people1, id = <span class="number">1</span></span><br><span class="line">people2</span><br><span class="line">name = people2, id = <span class="number">2</span></span><br><span class="line">people3</span><br><span class="line">name = people3, id = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>常用的API:</p>
<ul>
<li><p>boolean isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)<em>判断调用方是否被annotationClass注解修饰。</em></p>
</li>
<li><p>Annotation[] getAnnotations()<em>得到调用方的注解集合。</em></p>
</li>
<li><p><t extends="" annotation=""> T getAnnotation(Class<t> annotationClass)<em>得到调用方的被修饰的注解信息，应为一个调用方可以被多个注解修饰。</em></t></t></p>
</li>
</ul>
<h5 id="知名项目自定义注解集锦："><a href="#知名项目自定义注解集锦：" class="headerlink" title="知名项目自定义注解集锦："></a>知名项目自定义注解集锦：</h5><h6 id="ButterKnife-编译时"><a href="#ButterKnife-编译时" class="headerlink" title="ButterKnife(编译时)"></a>ButterKnife(编译时)</h6><ul>
<li>注解类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(CLASS) <span class="meta">@Target</span>(FIELD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BindView &#123;</span><br><span class="line">  <span class="comment">/** View ID to which the field will be bound. */</span></span><br><span class="line">  <span class="meta">@IdRes</span> <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注解解析器(ButterKnifeProcessor)</li>
</ul>
<p>init</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment env)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.init(env);</span><br><span class="line"></span><br><span class="line">    elementUtils = env.getElementUtils();</span><br><span class="line">    typeUtils = env.getTypeUtils();</span><br><span class="line">    filer = env.getFiler();</span><br><span class="line">    trees = Trees.instance(processingEnv);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>getSupportedAnnotationTypes</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getSupportedAnnotationTypes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Set&lt;String&gt; types = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Class&lt;? extends Annotation&gt; annotation : getSupportedAnnotations()) &#123;</span><br><span class="line">      types.add(annotation.getCanonicalName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> types;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Set&lt;Class&lt;? extends Annotation&gt;&gt; getSupportedAnnotations() &#123;</span><br><span class="line">    Set&lt;Class&lt;? extends Annotation&gt;&gt; annotations = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    annotations.add(BindArray.class);</span><br><span class="line">    annotations.add(BindBitmap.class);</span><br><span class="line">    annotations.add(BindBool.class);</span><br><span class="line">    annotations.add(BindColor.class);</span><br><span class="line">    annotations.add(BindDimen.class);</span><br><span class="line">    annotations.add(BindDrawable.class);</span><br><span class="line">    annotations.add(BindInt.class);</span><br><span class="line">    annotations.add(BindString.class);</span><br><span class="line">    annotations.add(BindView.class);</span><br><span class="line">    annotations.add(BindViews.class);</span><br><span class="line">    annotations.addAll(LISTENERS);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> annotations;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>getSupportedSourceVersion</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> SourceVersion <span class="title">getSupportedSourceVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> SourceVersion.latestSupported();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>process</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; elements, RoundEnvironment env)</span> </span>&#123;</span><br><span class="line">   Map&lt;TypeElement, BindingClass&gt; targetClassMap = findAndParseTargets(env);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (Map.Entry&lt;TypeElement, BindingClass&gt; entry : targetClassMap.entrySet()) &#123;</span><br><span class="line">     TypeElement typeElement = entry.getKey();</span><br><span class="line">     BindingClass bindingClass = entry.getValue();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span> (JavaFile javaFile : bindingClass.brewJava()) &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">         javaFile.writeTo(filer);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         error(typeElement, <span class="string">"Unable to write view binder for type %s: %s"</span>, typeElement,</span><br><span class="line">             e.getMessage());</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>当它发现一个类中含有任何一个注解时，ButterKnifeProcessor会通过<a href="https://github.com/square/javapoet" target="_blank" rel="external">javapoet</a>生成.java文件，名字类似<classname>$$ViewBinder，这个新生成的类实现了ViewBinder<t>接口</t></classname></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Collection&lt;JavaFile&gt; <span class="title">brewJava</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TypeSpec.Builder result = TypeSpec.classBuilder(binderClassName)</span><br><span class="line">            .addModifiers(PUBLIC, FINAL)</span><br><span class="line">            .addSuperinterface(ParameterizedTypeName.get(VIEW_BINDER, targetTypeName));</span><br><span class="line"></span><br><span class="line">    result.addMethod(createBindMethod(targetTypeName));</span><br><span class="line"></span><br><span class="line">    List&lt;JavaFile&gt; files = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (isGeneratingUnbinder()) &#123;</span><br><span class="line">      files.add(JavaFile.builder(unbinderClassName.packageName(), createUnbinderClass())</span><br><span class="line">              .addFileComment(<span class="string">"Generated code from Butter Knife. Do not modify!"</span>)</span><br><span class="line">              .build()</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isFinal) &#123;</span><br><span class="line">      result.addMethod(createBindToTargetMethod());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    files.add(JavaFile.builder(binderClassName.packageName(), result.build())</span><br><span class="line">            .addFileComment(<span class="string">"Generated code from Butter Knife. Do not modify!"</span>)</span><br><span class="line">            .build());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> files;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h6 id="AndroidEventBus-运行时"><a href="#AndroidEventBus-运行时" class="headerlink" title="AndroidEventBus(运行时)"></a>AndroidEventBus(运行时)</h6><ul>
<li>注解类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Subscriber &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 事件的tag,类似于BroadcastReceiver中的Action,事件的标识符</span><br><span class="line">     * </span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">String <span class="title">tag</span><span class="params">()</span> <span class="keyword">default</span> EventType.DEFAULT_TAG</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 事件执行的线程,默认为主线程</span><br><span class="line">     * </span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="function">ThreadMode <span class="title">mode</span><span class="params">()</span> <span class="keyword">default</span> ThreadMode.MAIN</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>解析注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findSubcribeMethods</span><span class="params">(Object subscriber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mSubcriberMap == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"the mSubcriberMap is null. "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;?&gt; clazz = subscriber.getClass();</span><br><span class="line">        <span class="comment">// 查找类中符合要求的注册方法,直到Object类</span></span><br><span class="line">        <span class="keyword">while</span> (clazz != <span class="keyword">null</span> &amp;&amp; !isSystemCalss(clazz.getName())) &#123;</span><br><span class="line">            <span class="keyword">final</span> Method[] allMethods = clazz.getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; allMethods.length; i++) &#123;</span><br><span class="line">                Method method = allMethods[i];</span><br><span class="line">                <span class="comment">// 根据注解来解析函数</span></span><br><span class="line">                Subscriber annotation = method.getAnnotation(Subscriber.class);</span><br><span class="line">                <span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 获取方法参数</span></span><br><span class="line">                    Class&lt;?&gt;[] paramsTypeClass = method.getParameterTypes();</span><br><span class="line">                    <span class="comment">// 订阅函数只支持一个参数</span></span><br><span class="line">                    <span class="keyword">if</span> (paramsTypeClass != <span class="keyword">null</span> &amp;&amp; paramsTypeClass.length == <span class="number">1</span>) &#123;</span><br><span class="line">                        Class&lt;?&gt; paramType = convertType(paramsTypeClass[<span class="number">0</span>]);</span><br><span class="line">                        EventType eventType = <span class="keyword">new</span> EventType(paramType, annotation.tag());</span><br><span class="line">                        TargetMethod subscribeMethod = <span class="keyword">new</span> TargetMethod(method, eventType,</span><br><span class="line">                                annotation.mode());</span><br><span class="line">                        subscibe(eventType, subscribeMethod, subscriber);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="comment">// end for</span></span><br><span class="line">              <span class="comment">// 获取父类,以继续查找父类中符合要求的方法</span></span><br><span class="line">            clazz = clazz.getSuperclass();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>反射调用上层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleEvent</span><span class="params">(Subscription subscription, Object event)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (subscription == <span class="keyword">null</span></span><br><span class="line">               || subscription.subscriber.get() == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// 执行</span></span><br><span class="line">           subscription.targetMethod.invoke(subscription.subscriber.get(), event);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/08/Android-Support-Annotations简介/" itemprop="url">
                  Android Support Annotations简介
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-08T20:47:20+08:00" content="2016-07-08">
              2016-07-08
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/08/Android-Support-Annotations简介/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/08/Android-Support-Annotations简介/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://tools.android.com/tech-docs/support-annotations" target="_blank" rel="external">原文地址</a></p>
<p>作为19.1版本的Android support library, 有一个新的注解包里面包含一定数量有用的元数据注解功能，你可以用它装饰你自己的代码，他能帮助你抓住一些bug, support library本身也被这些注解装饰，所以作为一个使用support library的用户来说，Android Studio将基于这些注解信息检查你的代码和一些潜在的问题，作为22.2版本，增加了13个新功能你也许会用到。</p>
<h3 id="Library搞起来"><a href="#Library搞起来" class="headerlink" title="Library搞起来"></a>Library搞起来</h3><p>注解功能并没有被默认包含在里面，他们封装成一个独立的library,（support library现在由一些更小的libraries组成，包括：v4-support, appcompat, gridlayout, mediatouter,等等）</p>
<p>假如你正在使用appcompat library, 你可以使用注解功能，因为appcompat他自己就依赖于它。</p>
<p>加入注解功能最简单的方法是打开Project Structure Dialog, 首先选择左边你要选择的module,然后在右边选择Dependencies tab选项，选择底部的+号按钮，然后选择Library Dependencies,此刻你要确认是否在你的sdk中安装Android Support仓库， support annonation library将是下面这个列表中填充连接的一个子项，你可以点击它（它将是这个列表中第一个元素）</p>
<p><img src="http://tools.android.com/_/rsrc/1411150773675/tech-docs/support-annotations/add-dependency.png" alt=""></p>
<p>点击OK完成这个编辑工作，这个将在你的build.gradle中被同步编辑，当然这个也可以手动添加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">'com.android.support:support-annotations:22.2.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于Android application和Android library这两个类型的module(你应用了com.android.application或者com.android.library插件的)来说，你需要做的已经都做好了。如果你想只在Java module使用这些注解，那么你就明确的包含SDK仓库了，因为support libraries不能从jcenter获得(Android Gradle插件会自动的包含这些依赖，但是Java插件却没有。)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">   jcenter()</span><br><span class="line">   maven &#123; url &apos;&lt;your-SDK-path&gt;/extras/android/m2repository&apos; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="执行注解"><a href="#执行注解" class="headerlink" title="执行注解"></a>执行注解</h4><p>当你用Android Studio和IntelliJ的时候，如果给标注了这些注解的方法传递错误类型的参数，那么IDE就会实时标记出来。</p>
<p>从Gradle插件1.3.0-beta1版本开始，并且安装了Android M Preview平台工具的情况下，通过命令行调用gradle的lint任务就可以执行这些检查。如果你想把标记问题作为持续集成的一部分，那么这种方式是非常有用的。说明：这并不包含nullness注解。本文中所介绍的其他注解都可以通过lint执行检查。</p>
<h4 id="Nullness-Annotations"><a href="#Nullness-Annotations" class="headerlink" title="Nullness Annotations"></a>Nullness Annotations</h4><p>@Nullable注解能用于修饰入参以及返回值可以为空。相似的，@NonNull注解能修饰入参与返回值不能为空。<br>如果一个本地变量的值为null(比如因为过早的代码检查它是否为null)，而你又把它作为参数传递给了一个方法，并且该方法的参数又被@NonNull标注，那么IDE会提醒你，你有一个潜在的崩溃问题。</p>
<p>v4 support library包中FragmentActivity片段代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.support.annotation.NonNull;</span><br><span class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Add support for inflating the &amp;lt;fragment&gt; tag.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(String name, @NonNull Context context, @NonNull AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<p>(如果你执行Analyze &gt; Infer Nullity，或者你在键入时把@NonNull替换成了@NotNull，那么IDE可能会提供附加的IntelliJ注解。参考底部的“IntelliJ Annotations”段落了解更多)</p>
<p>注意@NonNull和@Nullable并不是对立的：还有第三种可能：未指定。当你没有指定@NonNull或者@Nullable的时候，工具就不能确定，所以这个API也就不起作用。</p>
<p>最初，我们在findViewById方法上标注@Nullable，从技术上说，这是正确的：findViewById可以返回null。但是如果你知道你在做什么的时候(如果你传递给他一个存在的id)他是不会返回null的。当我们使用@Nullable注解它的时候，就意味着源代码编辑器中会有大量的代码出现高亮警告。如果你已经意识到每次使用该方法都应该明确的进行null检查，那么就只能用@Nullable标注返回值。有个经验规则：看现有的“好的代码”(比如审查产品代码)，看看这些API是怎么被使用的。如果该代码为null检查结果，你应该为方法注解@Nullable。</p>
<h4 id="Resource-Type-Annotations"><a href="#Resource-Type-Annotations" class="headerlink" title="Resource Type Annotations"></a>Resource Type Annotations</h4><p>Android的资源值通常都是使用整型传递。这意味着获取一个drawable使用的参数，也能很容易的传递给一个获取string的方法；因为他们都是int类型，编译器很难区分。</p>
<p>resource类型的注解可以在这种情况下提供类型检查，通过@StringRes注解一个int参数，只有R.string属性才能被IDE认可。<br><img src="http://tools.android.com/_/rsrc/1433281850285/tech-docs/support-annotations/image00.png" alt=""><br>ActionBar中的例子如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import android.support.annotation.StringRes;</span><br><span class="line">...</span><br><span class="line">    public abstract void setTitle(@StringRes int resId);</span><br></pre></td></tr></table></figure></p>
<p>有很多不同的resource类型的注解，其中一些注解类型如下：@StringRes，@DrawableRes，@ColorRes，@InterpolatorRES等等，假如你有一个资源类型为“foo”, 这个相应的资源类型注解为FooRes.</p>
<p>另外有一个特殊的资源注解类型为@AnyRes, 这种注解类型适用于不可知的特殊注解类型，但是它必须是一个资源类型，例如在Framework中，有一些被用在Resources#getResourceName(@AnyRes int resId)上，使用这个方法的时候，你能调用getResources().getResourceName(R.drawable.icon)和getResources().getResourceName(R.string.app_name),但是不能getResources().getResourceName(42)这样调用。</p>
<p>要说明的是，假如你的api支持多种资源类型，你能设置多个类型注解在你的参数中。</p>
<h4 id="IntDef-StringDef-Typedef"><a href="#IntDef-StringDef-Typedef" class="headerlink" title="IntDef/StringDef: Typedef"></a>IntDef/StringDef: Typedef</h4><p>整形除了表示Resource资源文件外， 也可以用作枚举类型使用。</p>
<p>@IntDef注解能够让很基础的创建一个typedef,通过创建注解你能设计出你所期盼的多种整形常量，然后你可以用这些包装你的API.<br>这是一个appcompat support library中的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.support.annotation.IntDef;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionBar</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@IntDef</span>(&#123;NAVIGATION_MODE_STANDARD, NAVIGATION_MODE_LIST, NAVIGATION_MODE_TABS&#125;)</span><br><span class="line">    <span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> NavigationMode &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NAVIGATION_MODE_STANDARD = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NAVIGATION_MODE_LIST = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NAVIGATION_MODE_TABS = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NavigationMode</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getNavigationMode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setNavigationMode</span><span class="params">(@NavigationMode <span class="keyword">int</span> mode)</span></span>;</span><br></pre></td></tr></table></figure>
<p>上面非注解的部分是现有的API。我们创建了一个新的注解(NavigationMode)并且用@IntDef标注它,通过@IntDef我们为返回值或者参数指定了可用的常量值。我们还添加了@Retention(RetentionPolicy.SOURCE)告诉编译器这个新定义的注解不需要被记录在生成的.class文件中(译者注：源代码级别的，生成class文件的时候这个注解就被编译器自动去掉了)。</p>
<p>通过这种注解方式，如果你传递的参数或者返回值不在指定的常量值中时，IDE将会标记出这种情况。<br><img src="http://tools.android.com/_/rsrc/1433281970170/tech-docs/support-annotations/image06.png" alt=""></p>
<p>你也可以指定一个整型是一个标记性质的类型；这样客户端代码就通过|，&amp;等操作符同时传递多个常量了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@IntDef</span>(flag=<span class="keyword">true</span>, value=&#123;</span><br><span class="line">           DISPLAY_USE_LOGO,</span><br><span class="line">           DISPLAY_SHOW_HOME,</span><br><span class="line">           DISPLAY_HOME_AS_UP,</span><br><span class="line">           DISPLAY_SHOW_TITLE,</span><br><span class="line">           DISPLAY_SHOW_CUSTOM</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line">   <span class="keyword">public</span> <span class="meta">@interface</span> DisplayOptions &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>最后，还有一个字符串版本的注解，就是@StringDef，它和@IntDef的作用基本上是一样，所不同的是它是针对字符串的。该注解一般不常用，但是有的时候非常有用，比如在限定向Activity#getSystemService方法传递的参数范围的时候。</p>
<h4 id="Threading-Annotations-UiThread-WorkerThread："><a href="#Threading-Annotations-UiThread-WorkerThread：" class="headerlink" title="Threading Annotations: @UiThread, @WorkerThread："></a>Threading Annotations: @UiThread, @WorkerThread：</h4><p>支持Support library 22.2以及以下版本<br>假如你的方法被调用在一些特殊类型的线程中，你能通过以下四种注解进行标记：</p>
<ul>
<li>@UiThread</li>
<li>@MainThread</li>
<li>@WorkerThread</li>
<li>@BinderThread</li>
</ul>
<p>假如类中所有的方法都是在同一个线程中执行，那么你可以注解类本身，例如android.view.View，他就被直接注解为@UiThread.</p>
<p>一个好的例子被用在AsyncTask中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WorkerThread</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Result <span class="title">doInBackground</span><span class="params">(Params... params)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@MainThread</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Progress... values)</span> </span>&#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>如果你在重写的doInBackground方法里尝试调用onProgressUpdate方法或者View的任何方法，IDE工具就会马上把它标记为一个错误：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//tools.android.com/_/rsrc/1433281805907/tech-docs/support-annotations/image04.png</span></span><br></pre></td></tr></table></figure>
<p>@UiThread还是@MainThread?</p>
<p>在进程里只有一个主线程。这个就是@MainThread。同时这个线程也是一个@UiThread。比如activity的主要窗口就运行在这个线程上。然而它也有能力为应用创建其他线程。这很少见，一般具备这样功能的都是系统进程。通常是把和生命周期有关的用@MainThread标注，和View层级结构相关的用@UiThread标注。但是由于@MainThread本质上是一个@UiThread，而大部分情况下@UiThread又是一个@MainThread，所以工具(lint ,Android Studio,等等)可以把他们互换，所以你能在一个可以调用@MainThread方法的地方也能调用@UiThread方法，反之亦然。</p>
<h4 id="RGB-Color-Integers"><a href="#RGB-Color-Integers" class="headerlink" title="RGB Color Integers"></a>RGB Color Integers</h4><p>当你的API期盼一个color资源你能@ColorRes注解进行设置，但是有些场景并不适应，因为你并不是期望一个颜色资源Id, 而是需要一个真实RGB或者ARGB颜色值。</p>
<p>正在下面的例子中，你能用@ColorInt注解进行标记。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void setTextColor(@ColorInt int color)</span><br></pre></td></tr></table></figure>
<p>有了这个，当你传递一个颜色id并不是颜色值的时候，lint就会标记这段错误的代码：</p>
<p><img src="http://tools.android.com/_/rsrc/1433282020892/tech-docs/support-annotations/image05.png" alt=""></p>
<h4 id="Size-IntRange-FloatRange"><a href="#Size-IntRange-FloatRange" class="headerlink" title="@Size, @IntRange, @FloatRange"></a>@Size, @IntRange, @FloatRange</h4><p>假如你的参数类型是一个float或者一个double类型，并且有一个限制的变动范围，你能用@FloatRange注解。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void setAlpha(@FloatRange(from=0.0, to=1.0) float alpha) &#123;</span><br></pre></td></tr></table></figure>
<p>假如有人使用该注解的时候传递一个0-255的值，比如这样调用setAlpha(128)，工具将抓到如下的错误：<br><img src="http://tools.android.com/_/rsrc/1433282066730/tech-docs/support-annotations/image08.png" alt=""><br>你也可以指定是否包括起始值</p>
<p>同样的假如你的参数类型为int或者long,你能用@IntRange注解来约束这个特殊值的范围。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void setAlpha(@IntRange(from=0,to=255) int alpha) &#123; … &#125;</span><br></pre></td></tr></table></figure></p>
<p>把这些注解应用到参数上是非常有用的，因为用户很有可能会提供错误范围的参数，比如上面的setAlpha例子，有的API是采用0-255的方式，而有的是采用0-1的float值的方式。</p>
<p>最后，对于arrays，collections，Strings，你也能通过@Size进行约束。</p>
<p>下面是一些例子：</p>
<ul>
<li>collection不能为空：@Size(min=1)</li>
<li>String字段的长度最长不能超过23个字符:@Size(max=23)</li>
<li>array的长度只能是2个元素：@Size(2)</li>
<li>array的长度是2的倍数：例如图形API中获取位置的x/y坐标数组@Size(muliple=2)</li>
</ul>
<p><img src="http://tools.android.com/_/rsrc/1433282097234/tech-docs/support-annotations/image03.png" alt=""></p>
<h4 id="RequiresPermission"><a href="#RequiresPermission" class="headerlink" title="@RequiresPermission"></a>@RequiresPermission</h4><p>假如你设计的方法被调用需要特定的权限，你能用@RequiresPermission注解来封装，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiresPermission</span>(Manifest.permission.SET_WALLPAPER)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setWallpaper</span><span class="params">(Bitmap bitmap)</span> <span class="keyword">throws</span> IOException</span>;</span><br></pre></td></tr></table></figure>
<p>假如你需要权限集合中一个权限，你能用anyof属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@RequiresPermission(anyOf = &#123;</span><br><span class="line">    Manifest.permission.ACCESS_COARSE_LOCATION,</span><br><span class="line">    Manifest.permission.ACCESS_FINE_LOCATION&#125;)</span><br><span class="line">public abstract Location getLastKnownLocation(String provider);</span><br></pre></td></tr></table></figure>
<p>假如你需要多个权限，请用allOf属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@RequiresPermission(allOf = &#123;</span><br><span class="line">    Manifest.permission.READ_HISTORY_BOOKMARKS, </span><br><span class="line">    Manifest.permission.WRITE_HISTORY_BOOKMARKS&#125;)</span><br><span class="line">public static final void updateVisitedHistory(ContentResolver cr, String url, boolean real) &#123;</span><br></pre></td></tr></table></figure>
<p>对于intents的权限，可以直接在定义的intent常量字符串字段上标注权限需求(他们通常都已经被@SdkConstant注解标注过了):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@RequiresPermission(android.Manifest.permission.BLUETOOTH)</span><br><span class="line">public static final String ACTION_REQUEST_DISCOVERABLE =</span><br><span class="line">            &quot;android.bluetooth.adapter.action.REQUEST_DISCOVERABLE&quot;;</span><br></pre></td></tr></table></figure>
<p>对于content providers的权限，你可能需要单独的标注读和写的权限访问，所以可以用@Read或者@Write标注每一个权限需求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@RequiresPermission.Read(@RequiresPermission(READ_HISTORY_BOOKMARKS))</span><br><span class="line">@RequiresPermission.Write(@RequiresPermission(WRITE_HISTORY_BOOKMARKS))</span><br><span class="line">public static final Uri BOOKMARKS_URI = Uri.parse(&quot;content://browser/bookmarks&quot;);</span><br></pre></td></tr></table></figure>
<p><img src="http://tools.android.com/_/rsrc/1433282206228/tech-docs/support-annotations/image01.png" alt=""></p>
<h4 id="CallSuper"><a href="#CallSuper" class="headerlink" title="@CallSuper"></a>@CallSuper</h4><p>假如你的API允许调用者重写其中一个方法,但是你需要自己的方法被调用者调用，你能用@CallSuper注解来实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@CallSuper</span><br><span class="line">protected void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br></pre></td></tr></table></figure>
<p>用了这个后，如果重写方法没有调用父方法时，工具将给出错误提示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://tools.android.com/_/rsrc/1433282184065/tech-docs/support-annotations/image02.png</span><br></pre></td></tr></table></figure></p>
<p>(Android Studio 1.3 Preview 1的lint检查有个关于这个注解的bug，这个bug就是即使是对的重写也会报错，这个bug已经在Preview 2版本修改，可以通过canary channel更新到Preview 2版本。)</p>
<h4 id="CheckResult"><a href="#CheckResult" class="headerlink" title="@CheckResult"></a>@CheckResult</h4><p>假如你的方法返回一个值并且希望调用者运用返回的值，你可以用@CheckResult注解来实现。</p>
<p>当然你也不需要为每个非空返回的方法都进行标注，这个注解的主要目的是帮助那些容易被混淆，难以被理解的API的使用者。<br>例如，很多开发者对String,trim()都不是很明白，大家都认为调用这个方法将导致String发生改变并且将移除空白的字符，如果这个方法被@CheckResult标注，工具就会对那些没有使用trim()返回结果的调用者发出警告。</p>
<p>Android中，Context#checkPermission这个方法已经被@CheckResult标注了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@CheckResult(suggest=&quot;#enforcePermission(String,int,int,String)&quot;)</span><br><span class="line">    public abstract int checkPermission(@NonNull String permission, int pid, int uid);</span><br></pre></td></tr></table></figure></p>
<p>这是非常重要的，因为有些使用context.checkPermission的开发者认为他们已经执行了一个权限,但其实这个方法仅仅只做了检查并且反馈一个是否成功的值而已。如果开发者使用了这个方法，但是又不用其返回值，那么这个开发者真正想调用的可能是这个Context#enforcePermission方法，而不是checkPermission。</p>
<p><img src="http://www.flysnow.org/uploads/2015/08/image07.png" alt=""></p>
<h4 id="VisibleForTesting"><a href="#VisibleForTesting" class="headerlink" title="@VisibleForTesting"></a>@VisibleForTesting</h4><p>你可以把这个注解标注到类、方法或者字段上，以便你在测试的时候可以使用他们。</p>
<h4 id="Keep"><a href="#Keep" class="headerlink" title="@Keep"></a>@Keep</h4><p>我们也增加了@Keep注解在support annotations中，这个可以避免被修饰的类或者方法被混淆。</p>
<h4 id="在你自己的库中使用注解"><a href="#在你自己的库中使用注解" class="headerlink" title="在你自己的库中使用注解"></a>在你自己的库中使用注解</h4><p>如果在你自己的库中使用了这些注解，并且是通过Gradle构建生成aar包，那么在构建的时候Android Gradle插件会提取注解信息放在AAR文件中供引用你的库的客户端使用。在AAR文件中你可以看到一个名为annotations.zip的文件，这个文件记录的就是注解信息，使用的是IntelliJ的扩展注解XML格式。这是必须的，因为.class文件不能包含足够的要处理以上@IntDef注解的信息；注意我们只需记录该常量的一个引用，而不是它的值。当且仅当你的工程依赖注解库的时候，Android Gradle插件会把提取注解的任务作为构建的一部分执行它。(说明：只有源保留注解被放置在.aar文件中；class级别的会被放在classes.jar里。)</p>
<h4 id="IntelliJ注解"><a href="#IntelliJ注解" class="headerlink" title="IntelliJ注解"></a>IntelliJ注解</h4><p>IntelliJ，Android Studio就是基于它开发的，IntelliJ有一套它自己的注解；IntDef分析其实重用的是MagicConstant分析的代码，IntelliJ null分析其实用的是一组配置好的null注解。如果你执行Analyze &gt; Infer Nullity…，它会试图找出所有的null约束并添加他们。这个检查有时会插入IntelliJ注解。你可以通过搜索,替换为Android注解库的注解，或者你也可以直接用IntelliJ注解。在build.gradle里或者通过Project Structure对话框的Dependencies面板都可以添加如下依赖：</p>
<p>dependencies {<br>    compile ‘com.intellij:annotations:12.0’<br>}</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://upload.cccnews.com.cn/2014/0313/1394690263626.jpg"
               alt="CoffeeTao" />
          <p class="site-author-name" itemprop="name">CoffeeTao</p>
          <p class="site-description motion-element" itemprop="description">生活在于折腾！</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">34</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://github.com/dashentao1989" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2433556600/profile?topnav=1&wvr=6&is_all=1" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CoffeeTao</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"dashentao1989"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  

  

  

</body>
</html>
